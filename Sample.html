<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catchup Messenger</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    }
    [contenteditable][data-placeholder]:empty:before {
      content: attr(data-placeholder);
      color: #6b7280;
      pointer-events: none;
      opacity: 0.7;
    }
    /* --- Animations (RETAINED) --- */
    @keyframes expandToFullScreen {
      0% {
        width: 56px;
        height: 56px;
        border-radius: 9999px;
        bottom: 24px;
        right: 24px;
      }
      100% {
        width: 100vw;
        height: 100vh;
        border-radius: 0;
        bottom: 0;
        right: 0;
      }
    }
    .expanding {
      animation: expandToFullScreen 0.3s ease-out forwards;
    }
    @keyframes slideOutLeft {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-100%);
      }
    }
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }
    .slide-out-left {
      animation: slideOutLeft 0.3s ease-out forwards;
    }
    .slide-in-right {
      animation: slideInRight 0.3s ease-out forwards;
    }
    /* --- Custom Bubble Styles --- */
    /* This style forces the bubble content to take full width inside the bubble, allowing flex behaviors */
    .stretched-bubble-content {
        display: flex;
        flex-direction: column;
        align-items: flex-end; 
        width: 100%;
        min-width: 0;
    }
    /* This wrapper ensures the text itself wraps naturally */
    .message-text-wrapper {
        width: 100%; 
        overflow-wrap: break-word; 
        word-break: break-word;
        text-align: left; 
        margin-bottom: 2px;
    }
    /* This line wrapper contains the final text segment and the timestamp/status */
    .auto-wrap-timestamp-line {
        display: flex;
        align-items: flex-end;
        justify-content: flex-end; /* Pushes content to the right edge */
        width: 100%;
    }
    .auto-wrap-timestamp-block {
        display: flex;
        align-items: center;
        gap: 4px;
        flex-shrink: 0; /* Prevents timestamp from shrinking */
        line-height: 1; 
        padding-left: 8px; 
        color: #6b7280; 
        font-size: 11px; 
    }
    /* FIX: Ensure line breaks are visible in contenteditable */
    .content-editable-input {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" src="menu.js"></script>
  <script type="text/babel" src="fab.js"></script>

  <script type="text/babel">
    const { useState, useRef } = React;

    // --- Icon Components (RETAINED) ---
    const Menu = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    );

    const Search = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    );

    const ArrowLeft = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
    );

    const MoreVertical = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="1"></circle>
        <circle cx="12" cy="5" r="1"></circle>
        <circle cx="12" cy="19" r="1"></circle>
      </svg>
    );
    
    // Check Icon (for read status)
    const Check = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M20 6 9 17l-5-5" />
      </svg>
    );
    // --- End Icon Components ---

    function CatchupMessenger() {
      const [isLoggedIn, setIsLoggedIn] = useState(true);
      const [isMenuOpen, setIsMenuOpen] = useState(false);
      const [isPopupOpen, setIsPopupOpen] = useState(false);
      const [isExpanding, setIsExpanding] = useState(false);
      const [isChatOpen, setIsChatOpen] = useState(false);
      const [selectedChat, setSelectedChat] = useState(null);
      
      const [messageInput, setMessageInput] = useState('');
      const hasText = messageInput.trim().length > 0;
      
      const [messages, setMessages] = useState([]);
      
      const messageInputRef = useRef(null);

      // --- Swipe to Close Logic (RETAINED) ---
      const touchStartX = useRef(0);
      const SWIPE_THRESHOLD = 80;

      const handleTouchStart = (e) => {
        if (isChatOpen) {
          touchStartX.current = e.touches[0].clientX;
        }
      };

      const handleTouchEnd = (e) => {
        if (!isChatOpen) return;

        const touchEndX = e.changedTouches[0].clientX;
        const deltaX = touchEndX - touchStartX.current;

        if (deltaX > SWIPE_THRESHOLD) {
          handleBackFromChat();
        }
        touchStartX.current = 0;
      };
      // ------------------------------------
      
      const handleInputChange = () => {
        if (messageInputRef.current) {
          setMessageInput(messageInputRef.current.innerText);
        }
      };
      
      const handleSend = () => {
        if (!hasText) return;

        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
        
        const newMessage = {
          id: Date.now(),
          text: messageInput.trim(),
          timestamp: timeString,
        };

        setMessages((prevMessages) => [...prevMessages, newMessage]);
        
        if (messageInputRef.current) {
          messageInputRef.current.innerText = '';
        }
        setMessageInput('');
      };


      const conversations = [
        {
          id: 1,
          name: 'Amaka',
          message: 'VaVia joined Telegram',
          date: 'Jun 26',
          avatarImage: 'https://i.ibb.co/C5b875C6/Screenshot-20250904-050841.jpg',
          lastSeen: 'last seen 11/4/2025'
        }
      ];

      const handleFloatingButtonClick = () => {
        setIsExpanding(true);
        setTimeout(() => {
          setIsPopupOpen(true);
          setIsExpanding(false);
        }, 300);
      };

      const handleConversationClick = (conversation) => {
        setSelectedChat(conversation);
        setIsChatOpen(true);
      };

      const handleBackFromChat = () => {
        setIsChatOpen(false);
        setSelectedChat(null);
      };

      // UPDATED HELPER COMPONENT: Uses the auto-wrap/stretched bubble pattern
      const SentMessageBubble = ({ text, timestamp }) => (
        <div className="flex justify-end">
            <div className="bg-[#D9F8C4] rounded-lg px-3 py-2 max-w-[95%] shadow-sm">
                <div className="stretched-bubble-content">
                    {/* Text wrapper to allow natural word wrapping over multiple lines */}
                    <span className="text-gray-900 text-[15px] message-text-wrapper">
                        {text}
                    </span>
                    {/* Final line containing timestamp, forced to the right edge */}
                    <div className="auto-wrap-timestamp-line">
                        <div className="auto-wrap-timestamp-block">
                            <span className="text-[11px] text-gray-600">{timestamp}</span>
                            <Check size={16} className="text-blue-500" strokeWidth={2} />
                        </div>
                    </div>
                </div>
            </div>
        </div>
      );


      return (
        <div className="w-full h-screen bg-white flex flex-col relative overflow-hidden">
          {isLoggedIn ? (
            <>
              {/* Main Messages View (RETAINED) */}
              <div className={isChatOpen ? 'slide-out-left' : ''}>
                {/* Header (Messages View) */}
                <div className="flex items-center justify-between px-4 py-3 shadow-sm">
                  <button
                    onClick={() => setIsMenuOpen(!isMenuOpen)}
                    className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                    aria-label="Menu"
                  >
                    <Menu />
                  </button>

                  <h1 className="text-xl font-semibold text-gray-800 absolute left-1/2 transform -translate-x-1/2">
                    Messages
                  </h1>

                  <button
                    className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                    aria-label="Search"
                  >
                    <Search />
                  </button>
                </div>

                {/* Conversation List */}
                <div className="flex-1 overflow-y-auto">
                  <div className="h-2 bg-gray-100"></div>
                  {conversations.map((conversation) => (
                    <div
                      key={conversation.id}
                      onClick={() => handleConversationClick(conversation)}
                      className="flex items-center px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                    >
                      <div className="w-14 h-14 rounded-full overflow-hidden flex-shrink-0">
                        <img 
                          src={conversation.avatarImage} 
                          alt={conversation.name}
                          className="w-full h-full object-cover"
                          draggable="false"
                        />
                      </div>

                      <div className="ml-4 flex-1 min-w-0">
                        <div className="flex items-baseline justify-between">
                          <h3 className="font-semibold text-gray-900 text-base">
                            {conversation.name}
                          </h3>
                          <span className="text-sm text-gray-500 ml-2">
                            {conversation.date}
                          </span>
                        </div>
                        <p className="text-gray-500 text-sm truncate mt-1">
                          {conversation.message}
                        </p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Floating Action Button Component (RETAINED) */}
              <FloatingActionButton 
                isPopupOpen={isPopupOpen}
                isMenuOpen={isMenuOpen}
                isChatOpen={isChatOpen}
                isExpanding={isExpanding}
                onClick={handleFloatingButtonClick}
              />

              {/* Chat View */}
              {isChatOpen && selectedChat && (
                <div 
                  className="fixed inset-0 z-50 flex flex-col slide-in-right" 
                  style={{
                    backgroundImage: 'url(https://i.ibb.co/0RMJ2TK3/Screenshot-20251125-105049.jpg)',
                    backgroundSize: 'cover',
                    backgroundPosition: 'center',
                    backgroundRepeat: 'no-repeat'
                  }}
                  onTouchStart={handleTouchStart}
                  onTouchEnd={handleTouchEnd}
                >
                  {/* Updated Chat Header (RETAINED) */}
                  <header className="bg-white shadow-sm">
                    <div className="flex items-center justify-between px-3 py-2.5">
                      <div className="flex items-center gap-4">
                        <button 
                          onClick={handleBackFromChat}
                          className="text-gray-600 hover:text-gray-800 transition-colors"
                        >
                          <ArrowLeft />
                        </button>
                        
                        <div className="flex items-center gap-2">
                          <div className="w-11 h-11 rounded-full bg-green-500 flex items-center justify-center text-white font-semibold text-lg overflow-hidden">
                            <img 
                              src={selectedChat.avatarImage} 
                              alt={selectedChat.name}
                              className="w-full h-full object-cover"
                              draggable="false"
                            />
                          </div>
                          
                          <div className="flex flex-col">
                            <h1 className="text-[19px] font-semibold text-gray-900">{selectedChat.name}</h1>
                            <p className="text-[13px] text-gray-500">{selectedChat.lastSeen}</p>
                          </div>
                        </div>
                      </div>
                      
                      <button className="text-gray-600 hover:text-gray-800 transition-colors">
                        <MoreVertical />
                      </button>
                    </div>
                  </header>

                  {/* Chat Area */}
                  <div className="flex-1 overflow-y-auto p-4 flex flex-col justify-end">
                    
                    {/* Messages Container */}
                    <div className="space-y-2 max-w-xl ml-auto">
                      
                      {/* 1. Custom two-line message (Fixed Breaks & Overflow Prevention) */}
                      <div className="flex justify-end">
                        <div className="bg-[#D9F8C4] rounded-lg px-3 py-2 shadow-sm" style={{ maxWidth: '90%' }}>
                          <div className="text-gray-900 text-[15px]">
                            {/* Line 1: Fffff... */}
                            <span>Fffffffffffffffffffffffffffffffffffffffffffffffffff</span>
                            <br/>
                            {/* Line 2 with inline timestamp */}
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end' }}>
                              <span>fffffffffffffffffff</span>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '4px', flexShrink: 0, marginLeft: '8px' }}>
                                <span className="text-[11px] text-gray-600">22:02</span>
                                <Check size={16} className="text-blue-500" strokeWidth={2} />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* 2. STRETCHED BUBBLE / SHORTER HEIGHT MESSAGE (Auto-Wrap) - This is the standard we're adopting */}
                      <div className="flex justify-end">
                        <div className="bg-[#D9F8C4] rounded-lg px-3 py-2 max-w-[95%] shadow-sm">
                            <div className="stretched-bubble-content">
                                <span className="text-gray-900 text-[15px] message-text-wrapper">
                                    Hello, this is a longer message that should force the layout into a multi-line state so we can test the inline timestamp feature.
                                </span>
                                <div className="auto-wrap-timestamp-line">
                                    <div className="auto-wrap-timestamp-block">
                                        <span className="text-[11px] text-gray-600">22:28</span>
                                        <Check size={16} className="text-blue-500" strokeWidth={2} />
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>

                      {/* 3. Short message with inline timestamp (Forced Inline) - RETAINED for visual variety */}
                      <div className="flex justify-end">
                        <div className="bg-[#D9F8C4] rounded-lg px-3 py-2 max-w-[85%] shadow-sm">
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', gap: '8px' }}>
                            <span className="text-gray-900 text-[15px]" style={{ whiteSpace: 'nowrap' }}>How are you doing today</span>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '4px', flexShrink: 0 }}>
                              <span className="text-[11px] text-gray-600">22:53</span>
                              <Check size={16} className="text-blue-500" strokeWidth={2} />
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* 4. Another short message with inline timestamp (Forced Inline) - RETAINED for visual variety */}
                      <div className="flex justify-end">
                        <div className="bg-[#D9F8C4] rounded-lg px-3 py-2 max-w-[85%] shadow-sm">
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', gap: '8px' }}>
                            <span className="text-gray-900 text-[15px]" style={{ whiteSpace: 'nowrap' }}>Hope you're doing great as well</span>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '4px', flexShrink: 0 }}>
                              <span className="text-[11px] text-gray-600">23:44</span>
                              <Check size={16} className="text-blue-500" strokeWidth={2} />
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      {/* NEW MESSAGES: Now using the robust auto-wrap/stretched bubble SentMessageBubble component */}
                      {messages.map((msg) => (
                        <SentMessageBubble key={msg.id} text={msg.text} timestamp={msg.timestamp} />
                      ))}
                    </div>
                  </div>

                  {/* Message Input */}
                  <div className="bg-white border-t border-gray-200">
                    <div className="w-full max-w-2xl mx-auto flex items-center p-2 gap-1">
                      
                      {/* Microphone/Emoji Button (Left side of input) */}
                      <button className="p-2 flex-shrink-0 self-end rounded-full">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <g transform="rotate(-19, 12, 12)">
                            <path d="M9 16C9.85038 16.6303 10.8846 17 12 17C13.1154 17 14.1496 16.6303 15 16" stroke="#6b7280" strokeWidth="2" strokeLinecap="round"></path>
                            <ellipse cx="15" cy="10.5" rx="1" ry="1.5" fill="#6b7280"></ellipse>
                            <ellipse cx="9" cy="10.5" rx="1" ry="1.5" fill="#6b7280"></ellipse>
                            <path d="M15 22H12C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12V15M15 22C18.866 22 22 18.866 22 15M15 22C15 20.1387 15 19.2081 15.2447 18.4549C15.7393 16.9327 16.9327 15.7393 18.4549 15.2447C19.2081 15 20.1387 15 22 15" stroke="#6b7280" strokeWidth="2"></path>
                          </g>
                        </svg>
                      </button>

                      {/* Content Editable Input */}
                      <div
                        ref={messageInputRef}
                        contentEditable
                        className="flex-1 bg-transparent text-gray-900 outline-none px-3 py-2 min-h-[40px] max-h-[120px] overflow-y-auto break-words content-editable-input"
                        data-placeholder="Message..."
                        suppressContentEditableWarning={true}
                        onInput={handleInputChange}
                      />
                      
                      {/* Attachment Button (Hides when text is present) */}
                      {!hasText && (
                        <button className="p-2 flex-shrink-0 self-end rounded-full transition-opacity duration-200">
                          <svg fill="#6b7280" viewBox="0 0 32 32" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                            <g transform="rotate(-42, 16, 16)">
                              <path d="M13.17,29.9a4,4,0,0,1-2.83-1.17L4.69,23.07a4,4,0,0,1,0-5.66L18.83,3.27a4.1,4.1,0,0,1,5.66,0L27.31,6.1a4,4,0,0,1,0,5.66L16,23.07a4,4,0,0,1-5.66-5.66l9.2-9.19L21,9.64l-9.19,9.19a2,2,0,0,0,2.83,2.83L25.9,10.34a2,2,0,0,0,0-2.83L23.07,4.69a2,2,0,0,0-2.83,0L6.1,18.83a2,2,0,0,0,0,2.83l5.66,5.65a2,2,0,0,0,2.83,0l12-12L28,16.71l-12,12A4,4,0,0,1,13.17,29.9Z"></path>
                            </g>
                          </svg>
                        </button>
                      )}
                      
                      {/* SEND BUTTON (Visible only when text is present) */}
                      <button 
                        onClick={handleSend} 
                        className="p-2 flex-shrink-0 self-end transition-all duration-200"
                        style={{ 
                            opacity: hasText ? 1 : 0, 
                            pointerEvents: hasText ? 'auto' : 'none', 
                            width: hasText ? 'auto' : 0, 
                            padding: hasText ? '0.5rem' : '0' 
                        }}>
                        <svg viewBox="0 -0.5 21 21" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.61258 9L0.05132 1.31623C-0.22718 0.48074 0.63218 -0.28074 1.42809 0.09626L20.4281 9.0963C21.1906 9.4575 21.1906 10.5425 20.4281 10.9037L1.42809 19.9037C0.63218 20.2807 -0.22718 19.5193 0.05132 18.6838L2.61258 11H8.9873C9.5396 11 9.9873 10.5523 9.9873 10C9.9873 9.4477 9.5396 9 8.9873 9H2.61258z" fill="#3b82f6" fillRule="evenodd" clipRule="evenodd" />
                        </svg>
                      </button>

                      {/* VOICE BUTTON (Only visible if send button is hidden) */}
                      {!hasText && (
                        <button className="p-2 flex-shrink-0 self-end hover:bg-gray-100 rounded-full transition-opacity duration-200">
                          <svg viewBox="0 0 24 24" fill="none" stroke="#6b7280" strokeWidth="1.8" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                            <rect x="8" y="2" width="8" height="13" rx="4"></rect>
                            <path d="M20,10v1a8,8,0,0,1-8,8h0a8,8,0,0,1-8-8V10"></path>
                            <line x1="12" y1="19" x2="12" y2="22"></line>
                          </svg>
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              )}

              {/* Contact Popup Component (RETAINED) */}
              <ContactPopup 
                isPopupOpen={isPopupOpen}
                onClose={() => setIsPopupOpen(false)}
              />

              {/* Menu Component (RETAINED) */}
              <MenuOverlay 
                isMenuOpen={isMenuOpen}
                onClose={() => setIsMenuOpen(false)}
              />
            </>
          ) : null}
        </div>
      );
    }

    ReactDOM.render(<CatchupMessenger />, document.getElementById('root'));
  </script>
</body>
</html>

